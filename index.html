<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=zh-cn lang=zh-cn><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.119.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>命叔瞎扯</title><meta name=description content="制作严肃艺术（不许笑的那种）作品，主要内容是关于禅与电单车维修"><link type=text/css rel=stylesheet href=https://oldrev.github.io/css/print.css media=print><link type=text/css rel=stylesheet href=https://oldrev.github.io/css/poole.css><link type=text/css rel=stylesheet href=https://oldrev.github.io/css/syntax.css><link type=text/css rel=stylesheet href=https://oldrev.github.io/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><link href=https://oldrev.github.io/index.xml rel=alternate type=application/rss+xml title=命叔瞎扯></head><body><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://oldrev.github.io/><h1>命叔瞎扯</h1></a><p class=lead>制作严肃艺术（不许笑的那种）作品，主要内容是关于禅与电单车维修</p></div><nav><ul class=sidebar-nav><li><a href=https://oldrev.github.io/>Home</a></li><li><a href=https://github.com/oldrev/>GitHub</a></li><li><a href=https://x.com/oldrev>Twitter/X</a></li><li><a href=/pages/about>关于我</a></li><li><a href=/posts>博客文章</a></li></ul></nav><p>&copy; 2024. All rights reserved.</p></div></aside><main class="content container"><div class=posts><article class=post><h1 class=post-title><a href=https://oldrev.github.io/2024/09/gcc-stateexpr/>使用 GCC 语句表达式模仿异常，简化错误处理</a></h1><time datetime=2024-09-14T04:42:39+0800 class=post-date>Sat, Sep 14, 2024</time>
嵌入式开发里，90% 情况下用的是 GCC，这里介绍一个 GCC 的 C 语言语法扩展，叫“语句表达式”（Statement Expression）。语句表达式，允许在表达式中包含多个语句，并返回最后一个表达式语句的值，比如：
#include &lt;stdio.h> int main() { int a = 5, b = 10; int result = ({ printf("Calculating the sum of %d and %d\n", a, b); a + b; }); printf("The result is %d\n", result); return 0; } 在这个例子中，({ ... }) 是一个语句表达式。它首先会打印一条调试信息，然后计算 a + b 并将结果返回给 result。
有了这个工具，可以很容易实现一个 TRY 宏：
#define TRY(expr, msg) ({ \ int result = (expr); \ if (result != 0) { \ fprintf(stderr, "Error: %s\n", msg); \ return result; \ } \ }) 这个宏里，我们判断 expr 是否等于 0，如果成功则继续执行，否则打印 msg 并提前返回，以下是完整可以跑的示例代码：<div class=read-more-link><a href=/2024/09/gcc-stateexpr/>Read More…</a></div></article><article class=post><h1 class=post-title><a href=https://oldrev.github.io/2024/09/hello-world/>Hello World</a></h1><time datetime=2024-09-14T00:44:25+0800 class=post-date>Sat, Sep 14, 2024</time>
整个测试下</article><article class=post><h1 class=post-title><a href=https://oldrev.github.io/pages/about/>关于我</a></h1><time datetime=0001-01-01T00:00:00Z class=post-date>Mon, Jan 1, 0001</time>
TODO</article></div></main></body></html>